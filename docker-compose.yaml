networks:
  mediastack:
    external: true

services:
  # The Website + CMS (Payload)
  security-guru:
    image: security-guru:latest
    container_name: security-guru
    restart: unless-stopped
    env_file: .env
    # depends_on:
    # - security-db
    networks:
      - mediastack # Join existing network
    ports:
      - ${WEB_PORT:?err}:3333
    volumes:
      # Map the uploads folder so images persist across container rebuilds
      - ${PROJECT_DIR:?err}/media:/app/public/media
    labels:
      - traefik.enable=true
      - traefik.http.routers.security-guru.rule=Host(`${CLOUDFLARE_DNS_ZONE_PROD:?err}`)
      - traefik.http.routers.security-guru.entrypoints=web
      - traefik.http.services.security-guru.loadbalancer.server.scheme=http
